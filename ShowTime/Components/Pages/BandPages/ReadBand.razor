@page "/bands"
@rendermode InteractiveServer

<PageTitle>Bands</PageTitle>

<h1>Bands</h1>

<DeleteBandModal @ref="_deleteModal" OnDeleted="ReloadBands" />

<DataGrid TItem="Band"
          Data="@_bands">
    <DataGridColumn TItem="Band" Field="@nameof(Band.Name)" Caption="Name" />
    <DataGridColumn TItem="Band" Field="@nameof(Band.Genre)" Caption="Genre" />

    <DataGridColumn TItem="Band" Caption="Actions">
        <DisplayTemplate>
            <Button Color="Color.Primary" Size="Size.Small" Clicked="e => UpdateSelectedBand(context)">
                <Blazorise.Icon Name="IconName.Edit" />
            </Button>
            <Button Color="Color.Danger" Size="Size.Small" Clicked="e => ShowDeleteModal(context)">
                <Blazorise.Icon Name="IconName.Delete" />
            </Button>
        </DisplayTemplate>
    </DataGridColumn>
</DataGrid>

<Button Color="Color.Primary" Clicked="@(e => NavigationManager.NavigateTo("/bands/create"))">Create</Button>

@code {
    [Inject]
    public required IBandRepository BandRepository { get; set; }
    [Inject]
    public required NavigationManager NavigationManager { get; set; }

    private IEnumerable<Band>? _bands;
    private DeleteBandModal? _deleteModal;

    protected override async Task OnInitializedAsync()
    {
        await ReloadBands();
    }

    private void UpdateSelectedBand(Band band)
    {
        NavigationManager.NavigateTo($"/bands/update/{band.Id}");
    }

    private void ShowDeleteModal(Band band)
    {
        _deleteModal?.ShowModal(band);
    }

    private async Task ReloadBands()
    {
        _bands = await BandRepository.GetAllAsync();
    }
}
